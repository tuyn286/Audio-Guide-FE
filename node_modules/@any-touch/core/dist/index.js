"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),e=require("any-event"),n=require("@any-touch/shared");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function o(){var e,r,o,a,u=0;return function(s){if(e=r,void 0!==s){var c=function(t,e){var r=t.phase,o=t.points,a=t.changedPoints,u=t.nativeEvent,s=o.length,c=n.TYPE_START===r,p=n.TYPE_END===r&&0===s||n.TYPE_CANCEL===r,v=Date.now(),f=i(o)||i(a),_=f.x,h=f.y,l=u.currentTarget;return Object.assign(t,{id:e,x:_,y:h,timestamp:v,isStart:c,isEnd:p,pointLength:s,currentTarget:l,getOffset:function(t){void 0===t&&(t=l);var e=t.getBoundingClientRect();return{x:_-Math.round(e.left),y:h-Math.round(e.top)}}})}(s,u=Number.MAX_SAFE_INTEGER>u?++u:1);r=c;var p=c.isStart,v=c.pointLength;return p&&(o=c,e=void 0,a=1<v?c:void 0),t.__assign(t.__assign({},c),{prevInput:e,startMultiInput:a,startInput:o})}}}function i(t){var e=t.length;if(0<e){if(1===e){var r=t[0],o=r.clientX,i=r.clientY;return{x:Math.round(o),y:Math.round(i)}}var a=t.reduce((function(t,e){return t.x+=e[n.CLIENT_X],t.y+=e[n.CLIENT_Y],t}),{x:0,y:0});return{x:Math.round(a.x/e),y:Math.round(a.y/e)}}}function a(t,e,n,r){var o,i={};for(var a in n)["target","currentTarget","type"].includes(a)||(i[a]=n[a]);return document.createEvent?(o=document.createEvent("HTMLEvents")).initEvent(t,null==r?void 0:r.bubbles,null==r?void 0:r.cancelable):o=new Event(t,r),Object.assign(o,i,{match:function(){return n.targets&&0<n.targets.length&&n.targets.every((function(t){return o.currentTarget.contains(t)}))}}),e.dispatchEvent(o)}function u(t,e){var n,r=e.preventDefault;return n=r,"[object Function]"===Object.prototype.toString.call(n)?r(t):!!r}var s=["touchstart","touchmove","touchend","touchcancel","mousedown"],c=["mousemove","mouseup"];var p={domEvents:{bubbles:!0,cancelable:!0},preventDefault:function(t){if(t.target&&"tagName"in t.target){var e=t.target.tagName;return!/^(?:INPUT|TEXTAREA|BUTTON|SELECT)$/.test(e)}return!1}},v=function(e){function n(n,r){var i,u=e.call(this)||this;u.v="2.1.3",u.__computeFunctionList=[],u.__computeFunctionCreatorList=[],u.__pluginContexts=[],u.__isIgnoreMouse=!1,u.el=n,u.c={},u.__options=t.__assign(t.__assign({},p),r);var v,f,_,h,l=function(t){var e=o();return function(n){var r=[],o=[];Array.from(n.touches).forEach((function(e){var n=e.clientX,i=e.clientY,a=e.target;(null==t?void 0:t.contains(a))&&(r.push(a),o.push({clientX:n,clientY:i,target:a}))}));var i=Array.from(n.changedTouches).map((function(t){return{clientX:t.clientX,clientY:t.clientY,target:t.target}}));return e({phase:n.type.replace("touch",""),changedPoints:i,points:o,nativeEvent:n,target:n.target,targets:r})}}(u.el),g=(f=!1,_=null,h=o(),function(t){var e,n=t.clientX,r=t.clientY,o=t.type,i=t.button,a=t.target,u=[{clientX:n,clientY:r,target:a}];if("mousedown"===o&&0===i)_=a,f=!0,e="start";else{if(!f)return;"mousemove"===o?e="move":"mouseup"===o&&(u=[],e="end",f=!1)}var s=v||[{clientX:n,clientY:r,target:a}];if(v=[{clientX:n,clientY:r,target:a}],void 0!==e)return h({phase:e,changedPoints:s,points:u,target:_,targets:[_],nativeEvent:t})});if(u.__inputCreatorMap=((i={}).touchstart=l,i.touchmove=l,i.touchend=l,i.touchcancel=l,i.mousedown=g,i.mousemove=g,i.mouseup=g,i),u.on("at:after",(function(t){var e=t.target,n=t.__type,r=u.__options.domEvents;r&&void 0!==u.el&&e&&(a(n,e,t,r),a("at:after",e,t,r))})),void 0!==n){n.style.webkitTapHighlightColor="rgba(0,0,0,0)";var d=!1;try{var m={};Object.defineProperty(m,"passive",{get:function(){d=!0}}),window.addEventListener("_",(function(){}),m)}catch(t){}u.on("u",function(t,e,n){return s.forEach((function(r){t.addEventListener(r,e,n)})),c.forEach((function(t){window.addEventListener(t,e,n)})),function(){s.forEach((function(n){t.removeEventListener(n,e)})),c.forEach((function(t){window.removeEventListener(t,e)}))}}(n,u.catchEvent.bind(u),!1===u.__options.preventDefault&&d?{passive:!0}:{passive:!1}))}return u}return t.__extends(n,e),n.prototype.use=function(t,e){this.__pluginContexts.push(t(this,e))},n.prototype.catchEvent=function(e){var n=this.__inputCreatorMap[e.type](e);if(void 0!==n){var r=function(){return e.preventDefault()};if(u(e,this.__options))r();else if("touchstart"===e.type?this.__isIgnoreMouse=!0:"touchmove"===e.type&&(this.__isIgnoreMouse=!1),this.__isIgnoreMouse&&e.type.startsWith("mouse"))return void("mouseup"===e.type&&(this.__isIgnoreMouse=!1));this.emit("input",n),this.emit2("at:".concat(n.phase),n,{});var o={};this.__computeFunctionList.forEach((function(t){var e=t(n,o);if(void 0!==e)for(var r in e)o[r]=e[r]})),this.emit("computed",t.__assign(t.__assign(t.__assign({},n),o),{stopPropagation:function(){return e.stopPropagation()},stopImmediatePropagation:function(){return e.stopImmediatePropagation()},preventDefault:r}))}},n.prototype.compute=function(e,n){var r,o;try{for(var i=t.__values(e),a=i.next();!a.done;a=i.next()){var u=a.value;this.__computeFunctionCreatorList.includes(u)||(this.__computeFunctionCreatorList.push(u),this.__computeFunctionList.push(u()))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}this.on("computed",n)},n.prototype.beforeEach=function(t){var n=this;e.prototype.beforeEach.call(this,(function(e,r){var o;(null===(o=n.c)||void 0===o?void 0:o.name)?t(e,r):r()}))},n.prototype.get=function(t){return this.__pluginContexts.find((function(e){return t===e.name}))},n.prototype.set=function(e){this.__options=t.__assign(t.__assign({},this.__options),e)},n.prototype.emit2=function(e,n,r){var o=this;this.c=r,this.emit(e,t.__assign(t.__assign({},n),{type:e}),(function(){o.emit("at:after",t.__assign(t.__assign({},n),{name:e,__type:e}))}))},n.prototype.destroy=function(){this.emit("u"),e.prototype.destroy.call(this)},n}(r(e).default);exports.default=v;
//# sourceMappingURL=index.js.map
